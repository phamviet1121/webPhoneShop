<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªëng K√™ Dashboard</title>
    <style>
        /* --- C·∫§U TR√öC CH√çNH --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9; /* M√†u n·ªÅn t·ªïng th·ªÉ x√°m nh·∫π d·ªãu m·∫Øt */
        }

        body {
            display: grid;
            grid-template-rows: auto 1fr 1fr; 
            grid-template-columns: repeat(3, 1fr);
            gap: 15px; /* TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c √¥ cho tho√°ng */
            padding: 15px;
        }

        /* --- HEADER --- */
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #2c3e50, #4ca1af); /* Header gradient sang tr·ªçng */
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h3 {
            margin: 0;
            font-size: 2.5vmin;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Form ch·ªçn ng√†y */
        .date-form {
            display: flex;
            gap: 8px;
            align-items: center;
            background: rgba(255, 255, 255, 0.2); /* N·ªÅn m·ªù cho form */
            padding: 5px 10px;
            border-radius: 5px;
        }

        .date-form input {
            padding: 5px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
            color: #333;
        }

        .date-form button {
            padding: 6px 15px;
            background-color: #ff9f43; /* M√†u cam n·ªïi b·∫≠t tr√™n n·ªÅn t·ªëi */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: transform 0.2s;
        }

        .date-form button:hover {
            background-color: #e58e26;
            transform: scale(1.05);
        }

        /* --- C√ÅC √î SECTION (CARD) --- */
        .section {
            background-color: white;
            border-radius: 15px; /* Bo tr√≤n g√≥c nhi·ªÅu h∆°n */
            
            /* ƒê·ªï b√≥ng nh·∫π l√∫c b√¨nh th∆∞·ªùng */
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.02);
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: 5px;
            text-align: center;
            position: relative;
            
            /* HI·ªÜU ·ª®NG CHUY·ªÇN ƒê·ªòNG M∆Ø·ª¢T M√Ä */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer; /* Con tr·ªè chu·ªôt th√†nh h√¨nh b√†n tay */
        }

        /* --- HI·ªÜU ·ª®NG KHI DI CHU·ªòT V√ÄO (HOVER) --- */
        .section:hover {
            /* N·ªïi l√™n tr√™n */
            transform: translateY(-10px); 
            
            /* B√≥ng ƒë·ªï ƒë·∫≠m h∆°n v√† lan r·ªông h∆°n */
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            
            /* ƒê·ªïi m√†u vi·ªÅn nh·∫π */
            border-color: #3498db;
        }
        
        /* Hi·ªáu ·ª©ng gradient n·ªÅn nh·∫π b√™n trong √¥ (t√πy ch·ªçn) */
        .section::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 5px;
            background: #e0e0e0; /* Thanh m√†u trang tr√≠ tr√™n ƒë·∫ßu m·ªói th·∫ª */
        }
        /* G√°n m√†u ri√™ng cho thanh trang tr√≠ t·ª´ng √¥ */
        .section:nth-child(2)::before { background: #3498db; } /* Doanh thu - Xanh */
        .section:nth-child(3)::before { background: #9b59b6; } /* T·ªïng ƒë∆°n - T√≠m */
        .section:nth-child(4)::before { background: #2ecc71; } /* Th√†nh c√¥ng - Xanh l√° */
        .section:nth-child(5)::before { background: #e74c3c; } /* Th·∫•t b·∫°i - ƒê·ªè */
        .section:nth-child(6)::before { background: #f39c12; } /* Ch·ªù x√°c nh·∫≠n - Cam */
        .section:nth-child(7)::before { background: #34495e; } /* Voucher - X√°m xanh */


        .content-wrap {
            width: 100%;
            font-size: 2vmin;
            z-index: 1; /* ƒê·ªÉ n·∫±m tr√™n c√°c l·ªõp trang tr√≠ */
        }

        .section h2 {
            margin: 0 0 1vh 0;
            color: #7f8c8d;
            font-weight: 600;
            font-size: 3.5vmin; /* Ch·ªØ ti√™u ƒë·ªÅ v·ª´a ph·∫£i */
            text-transform: uppercase; /* Ch·ªØ in hoa ti√™u ƒë·ªÅ */
            letter-spacing: 0.5px;
        }

        .section .number {
            font-weight: 800;
            color: #2c3e50;
            font-size: 5vmin; 
            word-break: break-word;
            line-height: 1.2;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.05);
        }

        /* M√†u ch·ªØ s·ªë li·ªáu */
        .green { color: #27ae60 !important; }
        .orange { color: #d35400 !important; }
        .blue { color: #2980b9 !important; }
        .red { color: #c0392b !important; }

        @media (max-width: 600px) {
            .header { flex-direction: column; gap: 10px; }
            body { padding: 5px; gap: 5px; }
        }
    </style>
</head>
<body>

    <!-- Header ch·ª©a Form ch·ªçn ng√†y -->
    <div class="header">
        <h3>üìä B√°o C√°o T·ªïng H·ª£p</h3>
        <form id="dateForm" class="date-form">
            <input type="date" id="startDate" required>
            <span style="color: white; font-weight: bold;">‚ûú</span>
            <input type="date" id="endDate" required>
            <button type="submit">Xem</button>
        </form>
    </div>

    <!-- √î 1: Doanh thu -->
    <div class="section">
        <div class="content-wrap">
            <h2>Doanh thu</h2>
            <div id="totalRevenue" class="number blue">...</div>
            <div style="font-size: 1.5vmin; color: #95a5a6; font-weight: bold;">VND</div>
        </div>
    </div>

    <!-- √î 2: T·ªïng ƒë∆°n h√†ng -->
    <div class="section">
        <div class="content-wrap">
            <h2>T·ªïng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m</h2>
            <div id="totalOrder" class="number">...</div>
        </div>
    </div>

    <!-- √î 3: ƒê∆°n th√†nh c√¥ng -->
    <div class="section">
        <div class="content-wrap">
            <h2>S·ªë l∆∞·ª£ng s·∫£n ph·∫©m th√†nh c√¥ng</h2>
            <div id="totalOrderSucces" class="number green">...</div>
        </div>
    </div>

    <!-- √î 4: ƒê∆°n th·∫•t b·∫°i -->
    <div class="section">
        <div class="content-wrap">
            <h2>ƒê∆°n th·∫•t b·∫°i</h2>
            <div id="totalOderFailed" class="number red">...</div>
        </div>
    </div>

    <!-- √î 5: Ch·ªù x√°c nh·∫≠n -->
    <div class="section">
        <div class="content-wrap">
            <h2>ƒê∆°n ch·ªù x√°c nh·∫≠n</h2>
            <div id="totalCountOrder" class="number orange">...</div>
        </div>
    </div>

    <!-- √î 6: Voucher ƒë√£ d√πng -->
    <div class="section">
        <div class="content-wrap">
            <h2>Voucher ƒë√£ d√πng</h2>
            <div id="totalQuantityAllVouchersForUser" class="number blue">...</div>
        </div>
    </div>

    <!-- JAVASCRIPT GI·ªÆ NGUY√äN -->
    <script>
        function formatDateLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        const formatCurrency = (value) => {
            if (value === undefined || value === null) return "0";
            return new Intl.NumberFormat('vi-VN').format(value);
        };

        async function loadData(startStr, endStr) {
            try {
                let url = '/phones/api/statistics/totalStatistics';
                if (startStr && endStr) {
                    url += `?startDate=${startStr}&endDate=${endStr}`;
                }

                const numbers = document.querySelectorAll('.number');
                numbers.forEach(el => el.style.opacity = '0.3'); // Hi·ªáu ·ª©ng loading m·ªù ƒëi

                const response = await fetch(url);
                if (!response.ok) throw new Error('L·ªói k·∫øt n·ªëi');
                const data = await response.json();

                document.getElementById('totalRevenue').innerText = formatCurrency(data.totalRevenue);
                document.getElementById('totalOrder').innerText = formatCurrency(data.totalOrder);
                document.getElementById('totalOrderSucces').innerText = formatCurrency(data.totalOrderSucces);
                document.getElementById('totalOderFailed').innerText = formatCurrency(data.totalOderFailed);
                document.getElementById('totalCountOrder').innerText = formatCurrency(data.totalCountOrder);
                document.getElementById('totalQuantityAllVouchersForUser').innerText = formatCurrency(data.totalQuantityAllVouchersForUser);

                numbers.forEach(el => el.style.opacity = '1'); // Hi·ªán r√µ l·∫°i

            } catch (error) {
                console.error('L·ªói:', error);
                alert("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu!");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const today = new Date();

            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);

            const startStr = formatDateLocal(firstDayOfMonth);
            const endStr = formatDateLocal(today);

            document.getElementById('startDate').value = startStr;
            document.getElementById('endDate').value = endStr;

            loadData(startStr, endStr);
        });

        document.getElementById('dateForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            if(start && end) loadData(start, end);
        });
    </script>
</body>
</html>