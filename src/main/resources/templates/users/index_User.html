<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Ch√†o m·ª´ng b·∫°n ƒë·∫øn c·ª≠a h√†ng c·ªßa ch√∫ng t√¥i</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/product-card.css}">
    <link rel="stylesheet" th:href="@{/css/discount-card.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <!-- CSS CHO N√öT L√äN ƒê·∫¶U TRANG -->
    <style>
        body{
            background-color: #ebf9f0;
        }
        #scrollToTopBtn {
            display: none; /* ·∫®n theo m·∫∑c ƒë·ªãnh */
            position: fixed; /* Gi·ªØ c·ªë ƒë·ªãnh khi cu·ªôn */
            bottom: 20px;
            left: 30px; /* ƒê·∫∑t ·ªü g√≥c d∆∞·ªõi b√™n tr√°i */
            z-index: 99; /* Lu√¥n n·ªïi l√™n tr√™n */
            border: none;
            outline: none;
            background-color: #007bff; /* M√†u xanh d∆∞∆°ng */
            color: white;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 50%; /* Bo tr√≤n */
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.2s;
        }

        #scrollToTopBtn:hover {
            background-color: #0056b3; /* ƒê·∫≠m h∆°n khi di chu·ªôt */
            transform: scale(1.1);
        }
        #discount-section-title,
        #upcoming-section-title {
            scroll-margin-top: 80px; /* Ch·ª´a ra 80px ph√≠a tr√™n khi cu·ªôn t·ªõi */
        }
        /* // */
        /* V√πng ch·ª©a c√°c v√© voucher */
.voucher-ticket-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 20px;
}

/* T·∫•m v√© */
.voucher-ticket {
    background: #fff;
    border-radius: 12px;
    border-left: 6px dashed #ff9800;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform .2s;
}

.voucher-ticket:hover {
    transform: translateY(-4px);
}

/* Header */
.ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.ticket-code {
    font-weight: bold;
    font-size: 18px;
    color: #007bff;
}

.ticket-percent {
    font-weight: bold;
    background: #ffc107;
    padding: 4px 10px;
    border-radius: 6px;
}

/* N·ªôi dung */
.ticket-body div {
    font-size: 14px;
    margin-bottom: 5px;
}

/* Footer */
.ticket-footer {
    text-align: center;
    margin-top: 10px;
}

.btn-collect {
    background: #007bff;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    width: 100%;
    transition: 0.2s;
}

.btn-collect:hover {
    background: #0056b3;
    color: #fff;
}

.voucher-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.voucher-view {
    overflow: hidden;
    width: 100%;
}

.voucher-track {
    display: flex;
    gap: 20px;
    transition: transform 0.4s ease;
}

/* M·ªói voucher chi·∫øm 1/3 chi·ªÅu r·ªông */
.voucher-ticket {
    width: calc(33.33% - 20px);
    background: #fbf9e7;
    border-left: 6px dashed #ff9800;
    border-radius: 12px;
    padding: 15px;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.ticket-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.ticket-code {
    font-weight: bold;
    font-size: 18px;
    color: #007bff;
}

.ticket-percent {
    background: #ffc107;
    padding: 4px 10px;
    border-radius: 6px;
    font-weight: bold;
}

.ticket-body div {
    font-size: 14px;
    margin-bottom: 5px;
}

.ticket-footer {
    text-align: center;
    margin-top: 10px;
}

.btn-collect {
    background: #007bff;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    width: 100%;
}

/* N√∫t ƒëi·ªÅu h∆∞·ªõng */
.voucher-nav-btn {
    background: #007bff;
    color: #fff;
    border: none;
    padding: 12px 16px;
    font-size: 20px;
    border-radius: 50%;
    cursor: pointer;
    position: absolute;
    z-index: 5;
    top: 50%;
    transform: translateY(-50%);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: 0.2s;
}

.voucher-nav-btn:hover {
    background: #0056b3;
}

.voucher-nav-btn.left {
    left: -10px;
}

.voucher-nav-btn.right {
    right: -10px;
}

/* Chia body voucher th√†nh 2 c·ªôt */
.ticket-body.two-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 15px;
}

/* C·ªôt tr√°i */
.ticket-left div {
    font-size: 14px;
    margin-bottom: 6px;
}

/* C·ªôt ph·∫£i */
.ticket-right {
    font-size: 14px;
}

.ticket-description {
    margin: 0;
    white-space: normal;     /* Cho ph√©p xu·ªëng d√≤ng */
    word-wrap: break-word;   /* C·∫Øt t·ª´ n·∫øu qu√° d√†i */
    line-height: 1.3;
}


    </style>
    
</head>
<body>

    <!-- PH·∫¶N 1 & 2: Header v√† Carousel -->
    <div th:replace="~{fragments/headerIndex :: header(showLoginButton=false, extraNavItems=~{bits/nav-items :: searchBar_user})}"></div>
    <div th:replace="~{fragments/carousel :: imageCarousel}"></div>

    <div th:if="${error}"
        id="error-message"
        th:text="${error}"
        style="display:none;"></div>

    <div th:if="${success}"
        id="success-message"
        th:text="${success}"
        style="display:none;"></div>

    <!-- PH·∫¶N 3: N·ªôi dung trang -->
    <div class="container page-content">
        <!-- THANH L·ªåC S·∫¢N PH·∫®M -->
        <div class="filter-bar">
            <div class="filter-group" id="brand-filter-group">
                <span class="group-label">Th∆∞∆°ng hi·ªáu:</span>
                <button class="filter-btn active" data-brand="all">T·∫•t c·∫£</button>
                <button class="filter-btn" data-brand="ios">iOS</button>
                <button class="filter-btn" data-brand="samsung">Samsung</button>
                <button class="filter-btn" data-brand="oppo">Oppo</button>
                <button class="filter-btn" data-brand="nokia">Nokia</button>
                <button class="filter-btn" data-brand="xiaomi">Xiaomi</button>
            </div>
            <div class="filter-group" id="price-sort-group">
                 <span class="group-label">S·∫Øp x·∫øp:</span>
                <select id="price-sorter" class="form-select" style="width: auto;">
                    <option value="default">M·∫∑c ƒë·ªãnh</option>
                    <option value="price-asc">Gi√°: Th·∫•p ƒë·∫øn Cao</option>
                    <option value="price-desc">Gi√°: Cao ƒë·∫øn Th·∫•p</option>
                </select>
            </div>
        </div>

        <div class="product-container">
            <!-- S·ª≠ d·ª•ng th:each ƒë·ªÉ l·∫∑p qua danh s√°ch s·∫£n ph·∫©m. JavaScript s·∫Ω qu·∫£n l√Ω vi·ªác hi·ªÉn th·ªã/·∫©n -->
            <div class="product-card" th:each="p : ${phonesWithPromotions}"
                th:attr="data-name=${p['NamePhoneId']}, data-price=${p['FinalPrice'] != null ? p['FinalPrice'] : p['PricePhone']}, data-brand=${p['BrandPhoneId']?.toLowerCase()}">

                <!-- ·∫¢nh s·∫£n ph·∫©m -->
                <div class="product-image">
                    <img th:src="${p['ImageUrlPhoneId'] != null ? p['ImageUrlPhoneId'] : 'https://via.placeholder.com/180'}" alt="·∫¢nh ƒëi·ªán tho·∫°i">
                </div>

                <!-- Th√¥ng tin s·∫£n ph·∫©m -->
                <div class="product-info">
                    <div class="product-name" th:text="${p['NamePhoneId']}"></div>
                    <div class="product-meta">
                        <span th:text="${p['BrandPhoneId']}"></span>
                        <div style="display: inline-block;">
                            <div th:if="${p['DiscountPhone'] == null or p['DiscountPhone'] == 0}">
                                <span th:text="${#numbers.formatInteger(p['PricePhone'], 0, 'COMMA')} + ' VNƒê'"></span>
                            </div>
                            <div th:if="${p['DiscountPhone'] != null and p['DiscountPhone'] > 0 and p['StatusDiscountPhone'] == 'active'}" class="discount-price-sale">
                                <div class="final-price" th:text="${#numbers.formatInteger(p['FinalPrice'], 0, 'COMMA')} + ' VNƒê'"></div>
                                <div class="old-price">
                                    <span class="price-strike" th:text="${#numbers.formatInteger(p['PricePhone'], 0, 'COMMA')} + ' VNƒê'"></span>
                                    <span class="discount-percent" th:text="'-' + ${p['DiscountPhone']} + '%'"></span>
                                </div>
                            </div>
                            <div th:if="${p['DiscountPhone'] != null and p['DiscountPhone'] > 0 and p['StatusDiscountPhone'] == 'upcoming'}" class="discount-price-upcoming">
                                <div class="upcoming-final-price badge bg-warning text-dark">
                                    <span th:text="${#numbers.formatInteger(p['PricePhone'] * (100 - p['DiscountPhone']) / 100, 0, 'COMMA')} + ' VNƒê'"></span>
                                </div>
                                <div class="upcoming-original-line">
                                    <span class="upcoming-original-price" th:text="${#numbers.formatInteger(p['PricePhone'], 0, 'COMMA')} + ' VNƒê'"></span>
                                    <span class="upcoming-discount-percent" th:text="'-' + ${p['DiscountPhone']} + '%'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="product-status">
                        <div th:if="${p['DiscountPhone'] != null and p['DiscountPhone'] > 0}">
                            <span th:text="${p['StatusPhone']}"></span> |
                            SL: <span th:text="${p['StockPhone']}"></span> /
                            <span th:text="${p['QuantityPhone']}"></span>
                        </div>
                        <div th:if="${p['DiscountPhone'] == null or p['DiscountPhone'] == 0}">
                            <span th:text="${p['StatusPhone']}"></span> |
                            SL: <span th:text="${p['StockPhone']}"></span>
                        </div>
                    </div>
                </div>
                <!-- N√∫t h√†nh ƒë·ªông -->
                <div class="action-buttons">
                    <a th:href="@{/phones/detail_user/{id}(id=${p['PhoneId']})}" class="btn btn-outline-primary btn-sm">Th√¥ng tin</a>
                    <a th:href="@{/orders/buy/{id}(id=${p['PhoneId']})}" 
                        class="btn btn-outline-primary btn-sm"
                        onmouseover="this.style.backgroundColor='#ffc107'; this.style.borderColor='#ffc107'; this.style.color='#000';"
                        onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#0d6efd'; this.style.color='#0d6efd';">
                        Mua
                    </a>
                    <form th:action="@{/phones/addCarIdUser/{id_phone}(id_phone=${p['PhoneId']})}"
                        method="post" style="display: inline;">

                        <button type="submit" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-cart-plus"></i>
                        </button>

                    </form>
                </div>
            </div>
        </div>

        <!-- THANH PH√ÇN TRANG -->
        <nav class="pagination-container" aria-label="Page navigation">
            <ul class="pagination justify-content-center" id="pagination-list"></ul>
        </nav>
    </div>

    <!-- PH·∫¶N 4: Carousel th·ª© hai -->
    <div th:replace="~{fragments/carousel :: imageCarousel_1}"></div>

    <!-- PH·∫¶N 5: Danh s√°ch s·∫£n ph·∫©m khuy·∫øn m√£i -->
    <div class="container mt-5">
        <h3 class="mb-4 text-primary fw-bold" id="discount-section-title">S·∫£n ph·∫©m khuy·∫øn m√£i</h3>
        <div class="discount-container">
            <div class="discount-card"
                 th:each="p : ${phonesWithPromotions}"
                 th:if="${p['DiscountPhone'] != null and p['DiscountPhone'] > 0 and p['StatusDiscountPhone'] == 'active'}">

                <div class="discount-image">
                    <img th:src="${p['ImageUrlPhoneId'] != null ? p['ImageUrlPhoneId'] : 'https://via.placeholder.com/180'}" alt="·∫¢nh ƒëi·ªán tho·∫°i">
                </div>
                <div class="discount-info">
                    <div class="discount-name" th:text="${p['NamePhoneId']}"></div>
                    <div class="discount-price-sale">
                        <div class="final-price" th:text="${#numbers.formatInteger(p['FinalPrice'], 0, 'COMMA')} + ' VNƒê'"></div>
                        <div class="old-price">
                            <span class="price-strike" th:text="${#numbers.formatInteger(p['PricePhone'], 0, 'COMMA')} + ' VNƒê'"></span>
                            <span class="discount-percent" th:text="'-' + ${p['DiscountPhone']} + '%'"></span>
                        </div>
                    </div>
                    <div class="quantity">
                        SL c√≤n l·∫°i: <span th:text="${p['StockPhone']}"></span> / <span th:text="${p['QuantityPhone']}"></span>
                    </div>
                </div>
                <div class="discount-actions">
                    <a th:href="@{/phones/detail_user/{id}(id=${p['PhoneId']})}" class="btn btn-outline-primary btn-sm">Th√¥ng tin</a>
                    <a th:href="@{/orders/buy/{id}(id=${p['PhoneId']})}" 
                        class="btn btn-outline-primary btn-sm"
                        onmouseover="this.style.backgroundColor='#ffc107'; this.style.borderColor='#ffc107'; this.style.color='#000';"
                        onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#0d6efd'; this.style.color='#0d6efd';">
                        Mua
                    </a>
                    <form th:action="@{/phones/addCarIdUser/{id_phone}(id_phone=${p['PhoneId']})}"
                        method="post" style="display: inline;">

                        <button type="submit" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-cart-plus"></i>
                        </button>

                    </form>
                </div>
            </div>
        </div>

        <!-- PH√ÇN TRANG KHUY·∫æN M√ÉI -->
        <nav class="pagination-container" aria-label="Page navigation">
            <ul class="pagination justify-content-center" id="discount-pagination"></ul>
        </nav>
    </div>

    <!-- PH·∫¶N 6: Carousel th·ª© ba -->
    <div th:replace="~{fragments/carousel :: imageCarousel_future}"></div>

    <!-- PH·∫¶N 7: s·∫£n ph·∫£m s·∫Øp khuy·∫øn m·∫°i -->
    <div class="container mt-5">
        <h3 class="mb-4 text-primary fw-bold" id="upcoming-section-title">S·∫£n ph·∫©m chu·∫©n b·ªã khuy·∫øn m√£i</h3>

        <!-- Danh s√°ch s·∫£n ph·∫©m UPCOMING -->
        <div id="upcoming-discount-container" class="discount-container">
            <!-- L·ªçc ngay trong th:each ƒë·ªÉ ch·ªâ l·∫∑p qua c√°c s·∫£n ph·∫©m c√≥ StatusDiscountPhone == 'upcoming' -->
            <div class="discount-card"
                th:each="p : ${phonesWithPromotions.?[StatusDiscountPhone == 'upcoming']}">

                <!-- ·∫¢nh s·∫£n ph·∫©m -->
                <div class="discount-image">
                    <img th:src="${p['ImageUrlPhoneId'] != null ? p['ImageUrlPhoneId'] : 'https://via.placeholder.com/180'}"
                        alt="·∫¢nh ƒëi·ªán tho·∫°i">
                </div>

                <!-- Th√¥ng tin s·∫£n ph·∫©m -->
                <div class="discount-info">
                    <!-- T√™n s·∫£n ph·∫©m -->
                    <div class="discount-name" th:text="${p['NamePhoneId']}"></div>

                    <!-- Th∆∞∆°ng hi·ªáu -->
                    <div class="discount-meta">
                        Th∆∞∆°ng hi·ªáu: <span th:text="${p['BrandPhoneId']}"></span>
                    </div>

                    <!-- Gi√° UPCOMING -->
                    <div class="discount-price-upcoming">
                        <!-- Gi√° sau khi gi·∫£m -->
                        <div class="upcoming-final-price badge bg-warning text-dark" style="margin-left: 70px;">
                            <span th:text="${#numbers.formatInteger(p['PricePhone'] * (100 - p['DiscountPhone']) / 100, 0, 'COMMA')} + ' VNƒê'"></span>
                        </div>

                        <!-- Gi√° g·ªëc + ph·∫ßn trƒÉm gi·∫£m -->
                        <div class="upcoming-original-line">
                            <span class="upcoming-original-price fw-bold"
                                th:text="${#numbers.formatInteger(p['PricePhone'], 0, 'COMMA')} + ' VNƒê'"></span>
                            <span class="upcoming-discount-percent"
                                th:text="'-' + ${p['DiscountPhone']} + '%'"></span>
                        </div>
                    </div>

                    <!-- Tr·∫°ng th√°i & s·ªë l∆∞·ª£ng -->
                    <div class="discount-status">
                        <span th:text="${p['StatusPhone']}"></span> |
                        SL: <span th:text="${p['StockPhone']}"></span> /
                        <span th:text="${p['QuantityPhone']}"></span>
                    </div>
                </div>

                <!-- N√∫t h√†nh ƒë·ªông -->
                <div class="discount-actions">
                    <a th:href="@{/phones/detail_user/{id}(id=${p['PhoneId']})}" class="btn btn-outline-primary btn-sm">Th√¥ng tin</a>
                    <a th:href="@{/orders/buy/{id}(id=${p['PhoneId']})}" 
                        class="btn btn-outline-primary btn-sm"
                        onmouseover="this.style.backgroundColor='#ffc107'; this.style.borderColor='#ffc107'; this.style.color='#000';"
                        onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#0d6efd'; this.style.color='#0d6efd';">
                        Mua
                    </a>
                    <form th:action="@{/phones/addCarIdUser/{id_phone}(id_phone=${p['PhoneId']})}"
                        method="post" style="display: inline;">

                        <button type="submit" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-cart-plus"></i>
                        </button>

                    </form>
                </div>
            </div>
        </div>

        <!-- PH√ÇN TRANG -->
        <nav class="pagination-container" aria-label="Page navigation">
            <ul class="pagination justify-content-center" id="upcoming-pagination"></ul>
        </nav>
    </div>

  <!-- PH·∫¶N 7.1: Voucher -->
<div class="container mt-5">
    <h3 class="mb-4 text-primary fw-bold">Voucher gi·∫£m gi√°</h3>

    <div class="voucher-wrapper">

        <!-- N√∫t sang tr√°i -->
        <button class="voucher-nav-btn left" id="voucher-prev">‚ùÆ</button>

        <!-- V√πng ch·ª©a 3 voucher hi·ªÉn th·ªã -->
        <div class="voucher-view">
            <div id="voucher-track" class="voucher-track">
                <div class="voucher-ticket" th:each="v : ${vouchers}">
                    <div class="ticket-header">
                        <span class="ticket-code" th:text="${v.code}"></span>
                        <span class="ticket-percent" th:text="${v.discountPercent + '%'}"></span>
                    </div>

                    <div class="ticket-body two-columns">

                        <!-- C·ªôt tr√°i -->
                        <div class="ticket-left">
                            <div><strong>T·ªëi ƒëa:</strong> <span th:text="${v.maxDiscount}"></span></div>
                            <div><strong>T·ªëi thi·ªÉu:</strong> <span th:text="${v.minOrderValue}"></span></div>

                            <div>
                                <strong>H·∫°n:</strong>
                                <span th:if="${v.expiredAt != null}"
                                    th:text="${#temporals.format(v.expiredAt, 'dd/MM/yyyy')}"></span>
                                <span th:if="${v.expiredAt == null}">Kh√¥ng</span>
                            </div>

                            <div>
                                <strong>Lo·∫°i:</strong>
                                <span th:text="${v.voucherType == 'order' ? 'ƒê∆°n h√†ng' : 'S·∫£n ph·∫©m'}"></span>
                            </div>
                        </div>

                        <!-- C·ªôt ph·∫£i -->
                        <div class="ticket-right">
                            <strong>M√¥ t·∫£:</strong>
                            <p class="ticket-description" th:text="${v.description}"></p>
                        </div>

                    </div>


                    <div class="ticket-footer">
                        <a class="btn btn-sm btn-collect"
                           th:href="@{'/phones/voucher/collect/' + ${v.id}}">
                            Thu th·∫≠p
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- N√∫t sang ph·∫£i -->
        <button class="voucher-nav-btn right" id="voucher-next">‚ùØ</button>

    </div>
</div>


    <!-- PH·∫¶N 8: Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>


    <!-- ====================================================== -->
    <!-- PH·∫¶N 9: N√öT M·ªû SIDEBAR V√Ä SIDEBAR ·∫®N B√äN TR√ÅI -->
    <!-- ====================================================== -->

    <!-- N√öT M·ªû SIDEBAR (ƒê√É ƒê∆Ø·ª¢C T√ÅCH RA NGO√ÄI) -->
    <button id="openSidebarBtn" title="M·ªü th√¥ng tin ng∆∞·ªùi d√πng">üë§</button>

    <!-- SIDEBAR ·∫®N -->
    <div id="userSidebar" class="sidebar">
        <div class="sidebar-header">
            <h5>Th√¥ng tin ng∆∞·ªùi d√πng</h5>
            <!-- N√öT ƒê√ìNG SIDEBAR (N·∫∞M B√äN TRONG) -->
            <button id="closeSidebarBtn" class="close-btn" title="ƒê√≥ng">√ó</button> 
        </div>
        <div class="sidebar-content">
            <p><strong>T√™n:</strong> <span th:text="${user.nameUser}"></span></p>
            <p><strong>Email:</strong> <span th:text="${user.gmailUser}"></span></p>
            <p><strong>ID Ng∆∞·ªùi d√πng:</strong> <span th:text="${session.idUser}"></span></p>
            <a th:href="@{/orders/orders_list_User/{userId}(userId=${session.idUser})}" class="sidebar-link">ƒê∆°n h√†ng c·ªßa t√¥i</a>
            <a th:href="@{/orders/carts_list_User_view/{userId}(userId=${session.idUser})}" class="sidebar-link">Gi·ªè h√†ng c·ªßa t√¥i</a>

            <a th:href="@{/auth/edit_user_index/{id}(id=${user.idUser})}" class="sidebar-link">S·ª≠a Th√¥ng Tin</a>
            <a th:href="@{/auth/logout}" class="sidebar-link logout-link">ƒêƒÉng xu·∫•t</a>
        </div>
    </div>

    <!-- N√öT L√äN ƒê·∫¶U TRANG -->
    <button onclick="scrollToTop()" id="scrollToTopBtn" title="L√™n ƒë·∫ßu trang">‚Üë</button>
    <script src="http://localhost:8080/js/chatbot-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {

        // ==========================================================
        // === LOGIC CHO S·∫¢N PH·∫®M TH∆Ø·ªúNG (PH·∫¶N 3)
        // ==========================================================
        const productContainer = document.querySelector('.product-container');
        if (productContainer) {
            const allProductCards = Array.from(productContainer.querySelectorAll('.product-card'));

            if (allProductCards.length > 0) {
                const brandFilterGroup = document.getElementById('brand-filter-group');
                const brandButtons = brandFilterGroup.querySelectorAll('.filter-btn');
                const priceSorter = document.getElementById('price-sorter');
                const paginationList = document.getElementById('pagination-list');
                const filterBar = document.querySelector('.filter-bar');

                const PRODUCTS_PER_PAGE = 6;
                let currentBrandFilter = 'all';
                let currentPriceSort = 'default';
                let currentPage = 1;
                let filteredAndSortedCards = [...allProductCards];

                function updateDisplay() {
                    let tempFiltered = allProductCards.filter(card => {
                        if (currentBrandFilter === 'all') return true;
                        const cardBrand = card.dataset.brand || '';
                        if (currentBrandFilter === 'ios' && (cardBrand.includes('apple') || cardBrand.includes('iphone'))) return true;
                        return cardBrand.includes(currentBrandFilter);
                    });

                    if (currentPriceSort === 'price-asc') {
                        tempFiltered.sort((a, b) => parseFloat(a.dataset.price) - parseFloat(b.dataset.price));
                    } else if (currentPriceSort === 'price-desc') {
                        tempFiltered.sort((a, b) => parseFloat(b.dataset.price) - parseFloat(a.dataset.price));
                    }

                    filteredAndSortedCards = tempFiltered;
                    currentPage = 1;
                    setupPagination(filteredAndSortedCards.length);
                    displayProductsForCurrentPage();
                }

                function setupPagination(totalItems) {
                    paginationList.innerHTML = '';
                    const pageCount = Math.ceil(totalItems / PRODUCTS_PER_PAGE);

                    for (let i = 1; i <= pageCount; i++) {
                        const pageItem = document.createElement('li');
                        pageItem.className = 'page-item' + (i === currentPage ? ' active' : '');
                        pageItem.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                        paginationList.appendChild(pageItem);
                    }
                }

                function displayProductsForCurrentPage() {
                    // X√≥a c√°c th·∫ª s·∫£n ph·∫©m hi·ªán t·∫°i kh·ªèi DOM tr∆∞·ªõc khi th√™m c√°c th·∫ª m·ªõi
                    while (productContainer.firstChild) {
                        productContainer.removeChild(productContainer.firstChild);
                    }

                    const startIndex = (currentPage - 1) * PRODUCTS_PER_PAGE;
                    const endIndex = startIndex + PRODUCTS_PER_PAGE;
                    const paginatedItems = filteredAndSortedCards.slice(startIndex, endIndex);

                    paginatedItems.forEach(card => productContainer.appendChild(card));
                }

                brandFilterGroup.addEventListener('click', function(event) {
                    if (event.target.classList.contains('filter-btn')) {
                        brandButtons.forEach(btn => btn.classList.remove('active'));
                        event.target.classList.add('active');
                        currentBrandFilter = event.target.dataset.brand;
                        updateDisplay();
                    }
                });

                priceSorter.addEventListener('change', function() {
                    currentPriceSort = priceSorter.value;
                    updateDisplay();
                });

                paginationList.addEventListener('click', function(event) {
                    event.preventDefault();
                    if (event.target.tagName === 'A') {
                        const pageNumber = parseInt(event.target.dataset.page);
                        if (filterBar) {
                            filterBar.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        if (pageNumber !== currentPage) {
                            currentPage = pageNumber;
                            setupPagination(filteredAndSortedCards.length);
                            displayProductsForCurrentPage();
                        }
                    }
                });

                updateDisplay();
            }
        }


        // ==========================================================
        // === LOGIC CHO S·∫¢N PH·∫®M KHUY·∫æN M√ÉI (PH·∫¶N 5)
        // ==========================================================
        const discountContainer = document.querySelector('.discount-container');
        if (discountContainer) {
            const discountCards = Array.from(discountContainer.querySelectorAll('.discount-card'));

            if (discountCards.length > 0) {
                const discountPagination = document.getElementById('discount-pagination');
                const discountSectionTitle = document.getElementById('discount-section-title');
                const DISCOUNT_PER_PAGE = 3;
                let discountCurrentPage = 1;

                function setupDiscountPagination() {
                    discountPagination.innerHTML = '';
                    const pageCount = Math.ceil(discountCards.length / DISCOUNT_PER_PAGE);

                    for (let i = 1; i <= pageCount; i++) {
                        const pageItem = document.createElement('li');
                        pageItem.className = 'page-item' + (i === discountCurrentPage ? ' active' : '');
                        pageItem.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                        discountPagination.appendChild(pageItem);
                    }
                }

                function displayDiscountPage() {
                    // X√≥a c√°c th·∫ª hi·ªán t·∫°i
                     while (discountContainer.firstChild) {
                        discountContainer.removeChild(discountContainer.firstChild);
                    }
                    const start = (discountCurrentPage - 1) * DISCOUNT_PER_PAGE;
                    const end = start + DISCOUNT_PER_PAGE;
                    const items = discountCards.slice(start, end);
                    items.forEach(card => discountContainer.appendChild(card));
                }

                discountPagination.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (e.target.tagName === 'A') {
                        const pageNum = parseInt(e.target.dataset.page);
                        if (discountSectionTitle) {
                            discountSectionTitle.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        if (pageNum !== discountCurrentPage) {
                            discountCurrentPage = pageNum;
                            setupDiscountPagination();
                            displayDiscountPage();
                        }
                    }
                });

                setupDiscountPagination();
                displayDiscountPage();
            }
        }

        // ==========================================================
        // === LOGIC CHO S·∫¢N PH·∫®M S·∫ÆP KHUY·∫æN M√ÉI (PH·∫¶N 7)
        // ==========================================================
        const upcomingDiscountContainer = document.getElementById('upcoming-discount-container');
        if (upcomingDiscountContainer) {
            const upcomingDiscountCards = Array.from(upcomingDiscountContainer.querySelectorAll('.discount-card'));

            if (upcomingDiscountCards.length > 0) {
                const upcomingPagination = document.getElementById('upcoming-pagination');
                const upcomingSectionTitle = document.getElementById('upcoming-section-title');
                const UPCOMING_PER_PAGE = 3;
                let upcomingCurrentPage = 1;

                function setupUpcomingPagination() {
                    upcomingPagination.innerHTML = '';
                    const pageCount = Math.ceil(upcomingDiscountCards.length / UPCOMING_PER_PAGE);

                    for (let i = 1; i <= pageCount; i++) {
                        const pageItem = document.createElement('li');
                        pageItem.className = 'page-item' + (i === upcomingCurrentPage ? ' active' : '');
                        pageItem.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                        upcomingPagination.appendChild(pageItem);
                    }
                }

                function displayUpcomingPage() {
                     // X√≥a c√°c th·∫ª hi·ªán t·∫°i
                    while (upcomingDiscountContainer.firstChild) {
                        upcomingDiscountContainer.removeChild(upcomingDiscountContainer.firstChild);
                    }
                    const start = (upcomingCurrentPage - 1) * UPCOMING_PER_PAGE;
                    const end = start + UPCOMING_PER_PAGE;
                    const items = upcomingDiscountCards.slice(start, end);
                    items.forEach(card => upcomingDiscountContainer.appendChild(card));
                }

                upcomingPagination.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (e.target.tagName === 'A') {
                        const pageNum = parseInt(e.target.dataset.page);
                        if (upcomingSectionTitle) {
                            upcomingSectionTitle.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        if (pageNum !== upcomingCurrentPage) {
                            upcomingCurrentPage = pageNum;
                            setupUpcomingPagination();
                            displayUpcomingPage();
                        }
                    }
                });

                setupUpcomingPagination();
                displayUpcomingPage();
            }
        }


        // ==========================================================
        // === LOGIC CHO N√öT L√äN ƒê·∫¶U TRANG
        // ==========================================================
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");
        if (scrollToTopBtn) {
            window.onscroll = function() {
                if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                    scrollToTopBtn.style.display = "block";
                } else {
                    scrollToTopBtn.style.display = "none";
                }
            };
        }
    });

    // H√†m n√†y ƒë∆∞·ª£c g·ªçi b·ªüi n√∫t HTML, n√™n ƒë·ªÉ b√™n ngo√†i
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    </script>
    <!-- Script t·ª± ·∫©n sau 3 gi√¢y -->
    <script>
        // Ch·ªù cho trang load xong
        window.addEventListener('DOMContentLoaded', function() {
            const alertBox = document.getElementById('alert-message');
            if (alertBox) {
                setTimeout(() => {
                    alertBox.classList.remove('show');   // ·∫©n hi·ªáu ·ª©ng Bootstrap
                    alertBox.classList.add('fade');      // th√™m hi·ªáu ·ª©ng m·ªù d·∫ßn
                    setTimeout(() => alertBox.remove(), 300); // sau hi·ªáu ·ª©ng th√¨ x√≥a h·∫≥n
                }, 3000); // 3000ms = 3 gi√¢y
            }
        });
    </script>
    <!-- SIDEBAR ·∫®N B√äN TR√ÅI -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('userSidebar');
            const openBtn = document.getElementById('openSidebarBtn');
            const closeBtn = document.getElementById('closeSidebarBtn');

            // S·ª± ki·ªán khi nh·∫•p v√†o n√∫t m·ªü
            if (openBtn) {
                openBtn.addEventListener('click', function() {
                    sidebar.classList.add('open');
                });
            }
            
            // S·ª± ki·ªán khi nh·∫•p v√†o n√∫t ƒë√≥ng
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    sidebar.classList.remove('open');
                });
            }

            // T√πy ch·ªçn: ƒê√≥ng sidebar khi nh·∫•p ra ngo√†i
            document.addEventListener('click', function(event) {
                // Ki·ªÉm tra xem sidebar c√≥ ƒëang m·ªü kh√¥ng, v√† ng∆∞·ªùi d√πng c√≥ nh·∫•p ra ngo√†i sidebar v√† ngo√†i n√∫t m·ªü kh√¥ng
                if (sidebar.classList.contains('open') && !sidebar.contains(event.target) && !openBtn.contains(event.target)) {
                    sidebar.classList.remove('open');
                }
            });
        });

        document.addEventListener("DOMContentLoaded", function () {

            const track = document.getElementById("voucher-track");
            const tickets = track.querySelectorAll(".voucher-ticket");

            const prevBtn = document.getElementById("voucher-prev");
            const nextBtn = document.getElementById("voucher-next");

            let index = 0;
            const visibleCount = 3;
            const total = tickets.length;

            function updateView() {
                const offset = -(index * (100 / visibleCount));
                track.style.transform = `translateX(${offset}%)`;
            }

            nextBtn.addEventListener("click", () => {
                index += 1;
                if (index > total - visibleCount) {
                    index = 0; // quay l·∫°i 3 v√© ƒë·∫ßu
                }
                updateView();
            });

            prevBtn.addEventListener("click", () => {
                index -= 1;
                if (index < 0) {
                    index = total - visibleCount; // nh·∫£y v·ªÅ cu·ªëi
                }
                updateView();
            });

        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        let errorDiv = document.getElementById("error-message");
        let successDiv = document.getElementById("success-message");

        // N·∫øu c√≥ l·ªói ‚Üí popup
        if (errorDiv) {
            Swal.fire({
                icon: 'error',
                title: 'L·ªói!',
                text: errorDiv.textContent,
                timer: 2500,
                timerProgressBar: true,
                showConfirmButton: false
            });
        }

        // N·∫øu c√≥ th√†nh c√¥ng ‚Üí popup
        if (successDiv) {
            Swal.fire({
                icon: 'success',
                title: 'Th√†nh c√¥ng!',
                text: successDiv.textContent,
                timer: 2500,
                timerProgressBar: true,
                showConfirmButton: false
            });
        }
    });
    </script>

</body>
</html>